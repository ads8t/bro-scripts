module Bash;

export {
	redef enum Notice::Type += {
		## Indicates that a host may have attempted a bash cgi header attack
		HTTP_Header_Attack,
	};
}

event http_header(c: connection, is_orig: bool, name: string, value: string) &priority=3
	{

	if ( is_orig )
		{
		if ( /\x7b.*\x7d.*\x3b/ in value )
			{
			NOTICE([$note=Bash::HTTP_Header_Attack,
				$conn=c,
				$msg=fmt("%s may have attempted a bash CGI HTTP header attack against %s submitting \"%s\"=\"%s\"",c$id$orig_h, c$id$resp_h, name, value),
				$identifier=c$uid]);
			}
		}
	
	}
